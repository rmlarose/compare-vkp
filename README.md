# compare-vkp

## Script usage

For the Hubbard model, the subspace matrices are computed by `hubbard_subspace_matrices.py`. A sample input file is as follows:
```
{
    "l": 2 # Size of the lattice.
    "n_occ": 2 # Number of fermions.
    "t": 1.0 # Hopping rate
    "u": 6.0 # Interaction energy
    "steps": 10 # Number of Trotter steps
    "ratio": 1e-4 # How close the reference is to the ground state
    "d": 10 # Subspace dimension
    "tau": 0.1 # Time for the unitary U
    "max_circuit_bond": 100 # Max bond dimension for the circuit simulator
    "max_mpo_bond": 100 # Max bond dimension of the Hamiltonian MPO
}
```
The script also expects an "exact input file" that is generated by `hubbard_exact.py`. It can be run from the same input file as ths subspace script so long as you add in the `alpha` parameter that ensures the particle number is respected by the Lanczos calculation. You could try setting `alpha=1.0` as an initial guess, though be sure to check the final particle number.

Once you have the subspace matrices calculated, you need to get the energies out of them. This is done by `hubbard_eigenvalues.py`. The JSON input file need only have the parameters `d` and `eps` in it. `d` is the subspace dimension, and `eps` is the eigenvalue threshold. You need to play with `eps` a bit to get good results. The script produces CSV and HDF5 output files with the energy as a function of the subspace dimension $d$. This script can be reused for the other scripts that produce subspace matrices.

For water, the current best code is `water_overlaps.py`. An example input file is as follows:
```
{
    "n_occ": 10,
    "steps": 10,
    "d": [10, 11, 12],
    "eps": 1e-4,
    "tau": 0.1,
    "max_circuit_bond": 200,
    "max_mpo_bond": 200,
    "mpo_filename": "water_mpo.data",
    "hamiltonian_directory": ".",
    "hamiltonian_file": "monomer_eqb.hdf5"
}
```
Note that `d` here is a list. You could use `[0, 1, ..., d]` if you want to compute the overlaps one at a time on the same node. However, I suggest running an array of jobs where you split the range over multiple computations. The output is a JSON file with a set of matrix elements ($\langle \psi | H U^k |\psi \rangle$) and overlaps ($\langle \psi | U^k |\psi \rangle$). There need to be assembled into a subspace matrix. I haven't written code for this yet because the jobs on the cluster aren't done. In theory this can be done by `fill_subspace_matrices` in `tensor_network_common.py`.

For the phosphate, I am currently using `phsophate_overlaps.py`. An example input file is as follows:
```
{
    "n_occ": 46,
    "alpha": 1.0,
    "steps": 1,
    "tau": 1e-1,
    "d": 2,
    "max_circuit_bond": 5,
    "max_mpo_bond": 5
}
```
The output is the same as for `water_overlaps.py`.

There is also a non-Toeplitz script for water (`water_non_toeplitz.py`). There are two arguments: `input_file` is a JSON file with the parameters, and `output_file` is an HDF5 file with the subspace matrices. The output file can be passed to `hubbard_eigenvalues.py` (along with a separate JSON file containing d and eps). An example input file is as follows:
```
{
    "hamiltonian_file": "monomer_eqb.hdf5",
    "hamiltonian_mpo_file": "water_mpo.data",
    "tau": 0.1,
    "d": 20,
    "steps": 10,
    "n_elec": 10,
    "max_circuit_bond": 200
}
```